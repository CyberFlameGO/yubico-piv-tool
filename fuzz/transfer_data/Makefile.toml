[tasks.build]
dependencies = ["build-target"]

[tasks.build-libafl]
command = "cargo"
args = ["build", "--release"]

[tasks.build-target]
dependencies = ["build-libafl"]
command = "../target/release/libafl_cc"
args = [
    "-fuse-ld=lld",
    "-fsanitize=address,undefined",
    "-I/usr/include/PCSC",
    "-O1",
    "-g",
    "-I../../lib",
    "-I../../common",
    "-Wl,--gc-sections",
    "../../bin/lib/libykpiv.a",
    "-Wl,--whole-archive",
    "../target/release/libtransfer_data.a",
    "-Wl,--no-whole-archive",
    "c/harness.c",
    "-Ic",
    "../piv_fuzz_common/c/pcsc_stubs.c",
    "../piv_fuzz_common/c/memcpy_rollover.c",
    "-o", "fuzzer"
]
